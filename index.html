<head>
	<title>GEMU</title>
</head>

<div>
	<div id="emulator">
		<p style="color:white" id="message">To play this game, please, download the latest Flash player!</p>
		<br>
		<a href="http://www.adobe.com/go/getflashplayer">
			<img src="//www.adobe.com/images/shared/download_buttons/get_adobe_flash_player.png" alt="Get Adobe Flash player"/>
		</a>
	</div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>

<script type="text/javascript">

	var romBytes = "";
	var fileType = "";
	
	var resizeOwnEmulator = function(width, height)
	{
		var emulator = $('#emulator');
		emulator.css('width', width/2);
		emulator.css('height', height/2);
	}
	
	function setUrl() {
		var emulator = $('#emulator');
		document.getElementById("message").innerHTML = "Loaded";
		//console.log('RUNLUA:print("retrived bytes: ' + romBytes + '")');
		if(emulator)
		{
			var flashvars = 
			{
				system : 'nes',
				url : ''
			};
			var params = {};
			var attributes = {};

			params.allowscriptaccess = 'sameDomain';
			params.allowFullScreen = 'true';
			params.allowFullScreenInteractive = 'true';

			swfobject.embedSWF('flash/Nesbox.swf', 'emulator', '320', '240', '11.2.0', 'flash/expressInstall.swf', flashvars, params, attributes, onFlashLoad);
		}
	}
	
	var onFlashLoad = function(e) {
		if(e.success) {
			var flObj = document.getElementsByTagName("object")[0];
			flObj.tabIndex = 1234;
			flObj.focus();
		}
	}
	
	function getFileFromByteArray(byteString) {
		var strBytes = byteString.split(" ");
		var bytes = [];
		for(i = 0; i < strBytes.length; i++) {
			bytes.push(parseInt(strBytes[i], 16));
		}
		var byteArray = new Uint8Array(bytes);
		var blob = new Blob([byteArray], {type: ""});
		var objectUrl = URL.createObjectURL(blob);
		return objectUrl;
		this.setUrl(objectUrl);
	}
	
	function setRomBytes(byteString) {
		romBytes = byteString;
	}
	
	function addToRomBytes(byteString) {
		romBytes += byteString;
		//console.log('RUNLUA:print("added bytes: ' + byteString + '")');
		return byteString;
	}
	
	function getBinaryData() {
		return romBytes;
	}
	
	function setFileType(type) {
		fileType = type;
	}
	
	function getFileType() {
		return fileType;
	}
	
</script>
